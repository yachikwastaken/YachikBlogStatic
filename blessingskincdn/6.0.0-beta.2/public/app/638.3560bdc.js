(self.webpackChunkblessing_skin_server=self.webpackChunkblessing_skin_server||[]).push([[638],{1570:(e,t)=>{t.w=function(e){return e}},5897:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var i=a(5944),s=a(3804),n=a(917),c=a(88);const l=n.iv`
  ::after {
    display: none;
  }
`,d=e=>{var t;const a=(0,s.useRef)(null);return(0,i.BX)("div",Object.assign({className:"form-group"},{children:[(0,i.tZ)("label",Object.assign({htmlFor:"select-file"},{children:(0,c.t)("skinlib.upload.select-file")}),void 0),(0,i.BX)("div",Object.assign({className:"input-group"},{children:[(0,i.BX)("div",Object.assign({className:"custom-file"},{children:[(0,i.tZ)("input",{type:"file",className:"custom-file-input",id:"select-file",accept:e.accept,title:(0,c.t)("skinlib.upload.select-file"),ref:a,onChange:e.onChange},void 0),(0,i.tZ)("label",Object.assign({className:"custom-file-label",css:l},{children:null===(t=e.file)||void 0===t?void 0:t.name}),void 0)]}),void 0),(0,i.tZ)("div",Object.assign({className:"input-group-append"},{children:(0,i.tZ)("button",Object.assign({className:"btn btn-default",onClick:()=>{a.current.click()}},{children:(0,c.t)("skinlib.upload.select-file")}),void 0)}),void 0)]}),void 0)]}),void 0)}},6309:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var i=a(5893),s=(a(3804),a(88));const n=()=>(0,i.jsxs)("div",Object.assign({className:"card"},{children:[(0,i.jsx)("div",Object.assign({className:"card-header"},{children:(0,i.jsx)("div",Object.assign({className:"d-flex justify-content-between"},{children:(0,i.jsx)("h3",Object.assign({className:"card-title"},{children:(0,i.jsx)("span",{children:(0,s.t)("general.texturePreview")},void 0)}),void 0)}),void 0)}),void 0),(0,i.jsx)("div",{className:"card-body"},void 0)]}),void 0)},9341:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var i=a(3804);function s(e,t){const[a,s]=(0,i.useState)(t);return(0,i.useEffect)((()=>{s(blessing.extra[e])}),[]),a}},9018:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var i=a(3804),s=a(3601);function n(){(0,i.useEffect)((()=>{(0,s.j)("mounted")}),[])}},9683:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var i=a(3804);function s(e){const t=(0,i.useRef)(null);return(0,i.useEffect)((()=>{const a=document.querySelector(e),i=document.createElement("div");return t.current=i,a.appendChild(i),()=>{a.removeChild(i),t.current=null}}),[]),t.current}},7109:(e,t,a)=>{"use strict";var i,s;a.d(t,{P:()=>i,N:()=>s}),function(e){e[e.Banned=-1]="Banned",e[e.Normal=0]="Normal",e[e.Admin=1]="Admin",e[e.SuperAdmin=2]="SuperAdmin"}(i||(i={})),function(e){e.Steve="steve",e.Alex="alex",e.Cape="cape"}(s||(s={}))},6638:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var i=a(5893),s=a(3804),n=a.n(s),c=a(7196),l=a.n(c),d=a(1570),r=a(88),o=a(9341),u=a(9018),v=a(9683),m=a(6703),h=a(439);function p(e){return e/64}function g(e,t,a){const i=e.getImageData(t,a,1,1);return 0===i.data[0]&&0===i.data[1]&&0===i.data[2]}function b(e){return new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{if(a.width!==a.height)return void t(!1);const e=document.createElement("canvas");!function(e,t){let a=!1;if(t.width!==t.height){if(t.width!==2*t.height)throw new Error(`Bad skin size: ${t.width}x${t.height}`);a=!0}const i=e.getContext("2d");if(a){const a=t.width;e.width=a,e.height=a,i.clearRect(0,0,a,a),i.drawImage(t,0,0,a,a/2),function(e,t){const a=p(t),i=(t,i,s,n,c,l,d)=>function(e,t,a,i,s,n,c,l){const d=e.getImageData(t,a,i,s);if(l)for(let e=0;e<s;e++)for(let t=0;t<i/2;t++){const a=4*(t+e*i),s=4*(i-t-1+e*i),n=d.data[a],c=d.data[a+1],l=d.data[a+2],r=d.data[a+3],o=d.data[s],u=d.data[s+1],v=d.data[s+2],m=d.data[s+3];d.data[a]=o,d.data[a+1]=u,d.data[a+2]=v,d.data[a+3]=m,d.data[s]=n,d.data[s+1]=c,d.data[s+2]=l,d.data[s+3]=r}e.putImageData(d,n,c)}(e,t*a,i*a,s*a,n*a,c*a,l*a,d);!function(e,t){if(!function(e,t,a,i,s){const n=e.getImageData(t,a,i,s);for(let e=0;e<i;e++)for(let t=0;t<s;t++){const a=4*(e+t*i);if(255!==n.data[a+3])return!0}return!1}(e,0,0,t,t/2)){const a=p(t),i=(t,i,s,n)=>e.clearRect(t*a,i*a,s*a,n*a);i(40,0,8,8),i(48,0,8,8),i(32,8,8,8),i(40,8,8,8),i(48,8,8,8),i(56,8,8,8)}}(e,t),i(4,16,4,4,20,48,!0),i(8,16,4,4,24,48,!0),i(0,20,4,12,24,52,!0),i(4,20,4,12,20,52,!0),i(8,20,4,12,16,52,!0),i(12,20,4,12,28,52,!0),i(44,16,4,4,36,48,!0),i(48,16,4,4,40,48,!0),i(40,20,4,12,40,52,!0),i(44,20,4,12,36,52,!0),i(48,20,4,12,32,52,!0),i(52,20,4,12,44,52,!0)}(i,a)}else e.width=t.width,e.height=t.height,i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0,e.width,e.height)}(e,a);const i=e.width/64,s=e.getContext("2d");if(s){for(let e=46*i;e<48*i;e+=1)for(let a=52*i;a<64*i;a+=1)if(!g(s,e,a))return void t(!1);t(!0)}else t(!1)}}))}var f=a(7109),j=a(8848),x=a(5897),N=a(6309);const w=n().lazy((()=>Promise.all([a.e(574),a.e(308),a.e(42)]).then(a.bind(a,617)))),k=(0,d.w)((()=>{var e;const[t,a]=(0,s.useState)(""),[c,d]=(0,s.useState)(f.N.Steve),[p,g]=(0,s.useState)(!1),[k,y]=(0,s.useState)(!1),[O,Z]=(0,s.useState)(null),[C,S]=(0,s.useState)(""),A=(0,o.Z)("rule"),I=(0,o.Z)("contentPolicy"),_=(0,o.Z)("privacyNotice"),E=(0,o.Z)("award"),P=(0,o.Z)("score",0),B=(0,o.Z)("scorePublic"),F=(0,o.Z)("scorePrivate"),R=(0,o.Z)("closetItemCost"),D=(0,v.Z)("#previewer");(0,u.Z)();const z=e=>{d(e.target.value)},L=p?F:B,T=null!==(e=null==O?void 0:O.size)&&void 0!==e?e:0,U=Math.ceil(T/1024)*L+R;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",Object.assign({className:"card card-primary"},{children:[(0,i.jsxs)("div",Object.assign({className:"card-body"},{children:[(0,i.jsxs)("div",Object.assign({className:"form-group"},{children:[(0,i.jsx)("label",Object.assign({htmlFor:"texture-name"},{children:(0,r.t)("skinlib.upload.texture-name")}),void 0),(0,i.jsx)("input",{className:"form-control",id:"texture-name",type:"text",placeholder:A,value:t,onChange:e=>{a(e.target.value)}},void 0)]}),void 0),(0,i.jsxs)("div",Object.assign({className:"form-group"},{children:[(0,i.jsx)("label",{children:(0,r.t)("skinlib.upload.texture-type")},void 0),(0,i.jsx)("br",{},void 0),(0,i.jsxs)("label",Object.assign({className:"mr-4"},{children:[(0,i.jsx)("input",{type:"radio",className:"mr-1",name:"type",value:"steve",checked:c===f.N.Steve,onChange:z},void 0),"Steve"]}),void 0),(0,i.jsxs)("label",Object.assign({className:"mr-4"},{children:[(0,i.jsx)("input",{type:"radio",className:"mr-1",name:"type",value:"alex",checked:c===f.N.Alex,onChange:z},void 0),"Alex"]}),void 0),(0,i.jsxs)("label",Object.assign({className:"mr-4"},{children:[(0,i.jsx)("input",{type:"radio",className:"mr-1",name:"type",value:"cape",checked:c===f.N.Cape,onChange:z},void 0),(0,r.t)("general.cape")]}),void 0)]}),void 0),(0,i.jsx)(x.Z,{file:O,accept:"image/png, image/x-png",onChange:async e=>{const i=e.target.files,[s]=i;if(s){Z(s),!t&&s.name.endsWith(".png")&&a(s.name.slice(0,s.name.length-4));const e=URL.createObjectURL(s);S(e),c!==f.N.Cape&&d(await b(e)?f.N.Alex:f.N.Steve)}}},void 0),I&&(0,i.jsx)("div",{className:"callout callout-warning",dangerouslySetInnerHTML:{__html:I}},void 0)]}),void 0),(0,i.jsxs)("div",Object.assign({className:"card-footer"},{children:[(0,i.jsxs)("div",Object.assign({className:"container px-0 d-flex justify-content-between"},{children:[(0,i.jsxs)("label",Object.assign({className:"mt-2",htmlFor:"is-private",title:(0,r.t)("skinlib.upload.privacy-notice")},{children:[(0,i.jsx)("input",{type:"checkbox",id:"is-private",className:"mr-1",checked:p,onChange:e=>{g(e.target.checked)}},void 0),(0,r.t)("skinlib.upload.set-as-private")]}),void 0),(0,i.jsx)("button",Object.assign({className:"btn btn-success",disabled:k,onClick:async()=>{if(!O)return void h.A.error((0,r.t)("skinlib.emptyUploadFile"));if(!t)return void h.A.error((0,r.t)("skinlib.emptyTextureName"));if("image/png"!==O.type&&"image/x-png"!==O.type)return void h.A.error((0,r.t)("skinlib.fileExtError"));const e=new FormData;e.append("name",t),e.append("type",c),e.append("file",O,O.name),e.append("public",p?"0":"1"),y(!0);const{code:a,message:i,data:{tid:s}={tid:0}}=await m.v_(j.Z.texture.upload(),e);if(y(!1),0===a)window.location.href=blessing.base_url+j.Z.skinlib.show(s);else if(2===a)try{await(0,h.K)({mode:"confirm",text:i,okButtonText:(0,r.t)("user.viewInSkinlib")}),window.location.href=blessing.base_url+j.Z.skinlib.show(s)}catch(e){}else h.A.error(i)}},{children:k?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("i",{className:"fas fa-spinner fa-spin mr-1"},void 0),(0,i.jsx)("span",{children:(0,r.t)("skinlib.uploading")},void 0)]},void 0):(0,r.t)("skinlib.upload.button")}),void 0)]}),void 0),O&&(0,i.jsxs)("div",Object.assign({className:`callout callout-${P>U?"success":"danger"} mt-3`},{children:[(0,i.jsx)("div",{children:(0,r.t)("skinlib.upload.cost",{score:U})},void 0),(0,i.jsxs)("div",{children:[(0,r.t)("user.cur-score"),(0,i.jsx)("span",Object.assign({className:"ml-1"},{children:P}),void 0)]},void 0)]}),void 0),p&&(0,i.jsx)("div",Object.assign({className:"callout callout-info mt-3"},{children:_}),void 0),!p&&E>0&&(0,i.jsx)("div",Object.assign({className:"callout callout-success mt-3"},{children:(0,r.t)("skinlib.upload.award",{score:E})}),void 0)]}),void 0)]}),void 0),D&&l().createPortal((0,i.jsx)(n().Suspense,Object.assign({fallback:(0,i.jsx)(N.Z,{},void 0)},{children:(0,i.jsx)(w,{skin:c!==f.N.Cape?C:void 0,cape:c===f.N.Cape?C:void 0,isAlex:c===f.N.Alex},void 0)}),void 0),D)]},void 0)}))}}]);